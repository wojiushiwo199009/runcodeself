<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        html,
        body {
            height: 100%;
            width: 100%;
            margin: 0;
        }
    </style>
</head>

<body>
    <div style="display: none;" id="pipContent">
        <iframe src="http://www.webgl3d.cn/pages/5005d5/" frameborder="0"></iframe>
    </div>
    <button id="clickBtn">åˆ‡æ¢ç”»ä¸­ç”»</button>
    <button id="export">å¯¼å‡º</button>
    <script type="importmap">
      {
        "imports": {
          "three": "../../js/three.module.js",
          "three/addons/": "../../js/jsm/"
        }
      }
    </script>
    <script type="module">

        // æ£€æŸ¥æ˜¯å¦æ”¯æŒ PiP åŠŸèƒ½
        if ('documentPictureInPicture' in window) {
            console.log("ğŸš€ æµè§ˆå™¨æ”¯æŒ PiP åŠŸèƒ½ï¼");
        } else {
            console.warn("âš ï¸ å½“å‰æµè§ˆå™¨ä¸æ”¯æŒ PiP åŠŸèƒ½ï¼Œæ›´æ–°æµè§ˆå™¨æˆ–è€…æ¢å°ç”µè„‘å§ï¼");
        }

        // è¯·æ±‚ PiP çª—å£
        document.getElementById("clickBtn").addEventListener("click", async function () {
            const pipContent = document.getElementById("pipContent");
            // è¯·æ±‚åˆ›å»ºä¸€ä¸ª PiP çª—å£
            const pipWindow = await window.documentPictureInPicture.requestWindow({
                width: 200,  // è®¾ç½®çª—å£çš„å®½åº¦
                height: 300  // è®¾ç½®çª—å£çš„é«˜åº¦
            });

            // å°†åŸå§‹å…ƒç´ å…‹éš†å¹¶æ·»åŠ åˆ° PiP çª—å£ä¸­
            pipWindow.document.body.appendChild(pipContent.cloneNode(true));

            // è®¾ç½® PiP æ ·å¼åŒæ­¥
            [...document.styleSheets].forEach((styleSheet) => {
                try {
                    const cssRules = [...styleSheet.cssRules].map((rule) => rule.cssText).join('');
                    const style = document.createElement('style');
                    style.textContent = cssRules;
                    pipWindow.document.head.appendChild(style);
                } catch (e) {
                    const link = document.createElement('link');
                    link.rel = 'stylesheet';
                    link.type = styleSheet.type;
                    link.media = styleSheet.media;
                    link.href = styleSheet.href ?? '';
                    pipWindow.document.head.appendChild(link);
                }
            });
            pipWindow.document.getElementById('pipContent').style.display = 'block'


            // ç›‘å¬è¿›å…¥å’Œé€€å‡º PiP æ¨¡å¼çš„äº‹ä»¶
            pipWindow.addEventListener("pagehide", (event) => {
                console.log("å·²é€€å‡º PIP çª—å£");
            });

            pipWindow.addEventListener('focus', () => {
                console.log("PiP çª—å£è¿›å…¥äº†ç„¦ç‚¹çŠ¶æ€");
            });

            pipWindow.addEventListener('blur', () => {
                console.log("PiP çª—å£å¤±å»äº†ç„¦ç‚¹");
            });
        });

        // å…³é—­ PiP çª—å£
        // pipWindow.close();  // å¯ä»¥æ‰‹åŠ¨è°ƒç”¨å…³é—­çª—å£


        import * as THREE from "three";
        import { scene } from './index.js'
        import { modal } from "./modal.js";

        import { exportGLTF } from './exportGLTF.js'
        let button = document.getElementById('export')
        // ä¸‹è½½gltfç±»å‹çš„æ¨¡å‹æ–‡ä»¶ï¼Œå¯¼å‡ºgltfç±»å‹çš„æ¨¡å‹æ–‡ä»¶
        button.addEventListener('click', function () {
            exportGLTF(modal)
        })

    </script>
</body>

</html>